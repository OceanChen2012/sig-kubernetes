# scheduler源码分享讲师招募

Kubernetes  源码研习社二期活动——调度器源码剖析，为了更好的让大家理解调度器源码，特讲师招募。

讲解的内容见下面的Task划分，每个小结我们准备招募一个讲师，在规定时间内讲解所列内容，当然时间可灵活调整。

内容划分是参考张东旭大佬《kubernestes 源码剖析》，但是尽信书则无书，我们只是按书的内容划分Task而已，我们希望听到更经典、更精彩、更具扩展性和实用性的讲解。

因为我们是大工作划成小工作，为的就是不占用大家太多时间来准备。所以讲解的时候务必注意和前面同学的衔接。每个人要做到既能承前顺利进入内容，又能抛砖引玉，引出后面同学的精彩分享，毕竟大家是一个整体，就要统一、和谐。

大家会统一用腾讯会议分享，至于分享的内容您用PPT还是思维导图，还是实际操作来呈现，我们不设限制，我们要的只是简单、精彩、好理解。

想分享的同学，找社长[厉辉](https://github.com/Miss-you)报备一下，然后统一安排大家时间。

## 一、Task划分
1. 开场综述 （10m）
- scheduler在整个k8s架构图的位置、作用、 Pod流程综述
- Pod在scheduler中的调度过程，最好来张简单的图【书8.2和8.7.1章】

2. 启动过程前半部分代码导读（15m）
- scheduler参数介绍【书8.1】
- 命令行参数解析源码分享 【书8.3.2】
- 实例化scheduler过程 源码分享 【书8.3.3】
- 随带 把调度算法的注册和实例化部分重点介绍下，包括如何从配置文件指定调度算法【书8.3.1 + 自由发挥】

3. 启动过程后半部分代码导读 (20m)
- 事件管理器EventBroadcaster的介绍和在scheduler中的作用和注册过程分【书8.3.4】
- HTTP和HTTPS部分代码，重点可以强调下怎么给scheduler加API接口【书8.3.5】
- 运行调度器Infomer同步资源，中间强调调度器如何保持资源状态一致性的【书8.3.6】
- 代码分享直到sched.Run()，重点sched.Run()的检查项【书8.38】

4. 预选和优选调度算法和代码介绍（20m）
- 过一下所有的预选和优选调度算法，简要讲解影响，特别是组合值的影响【书8.6】
-  预选和优选调度代码分享 【书8.7.2章】

5. 优先级和抢占机制 (20m)
- 优先级和抢占机制介绍【书8.4章】
- 抢占代码分享【书8.7.3章】
- 亲和性调度 介绍 设置 演示 代码剖析 【书8.5章】

6. 选举算法剖析 (20m)
- 选举算法介绍、作用、为什么需要，可强调如何在保证调度器高可用的 【书8.3.7章】
- 选举算法的具体代码剖析和实现 【书8.8章】

7. 小结
- 小结今天的内容
- 感谢大家的分享
- 预告下期分享

## 二、 开发练习题
##### 1. 给调度器添加一个接口，可在10m内获取已经调度pod的node计分，只展示Top10；(尽可能的展示出，输入pod在之前调度的实际计分情况)

输入：已调度的pod name

输出：

```
[
    {
        "Host":"10.0.2.130",
        "Score":100023
    },
    {
        "Host":"10.0.2.142",
        "Score":100023
    },
    {
        "Host":"10.0.2.164",
        "Score":100022
    },
    {
        "Host":"10.0.2.57",
        "Score":100022
    }
]
```

    提示：可利用调度器的快照

##### 2. 给调度器添加一个接口，只展示优选算法的计分情况，每个算法只展示5个node；（；(尽可能的展示出输入pod，在之前调度的实际计分情况)）

输入：已调度的pod name

输出：

```
[
    {
        "Strategy":"LeastRequestedPriority",
        "Weight":1,
        "HostPriority":[
            {
                "Host":"10.0.2.142",
                "Score":3
            },
            {
                "Host":"10.0.2.57",
                "Score":3
            },
            {
                "Host":"10.0.2.130",
                "Score":2
            },
            {
                "Host":"10.0.2.164",
                "Score":2
            }
        ]
    },
    {
        "Strategy":"NodeAffinityPriority",
        "Weight":1,
        "HostPriority":[
            {
                "Host":"10.0.2.130",
                "Score":0
            },
            {
                "Host":"10.0.2.142",
                "Score":0
            },
            {
                "Host":"10.0.2.164",
                "Score":0
            },
            {
                "Host":"10.0.2.57",
                "Score":0
            }
        ]
    },
    {
        "Strategy":"NodePreferAvoidPodsPriority",
        "Weight":10000,
        "HostPriority":[
            {
                "Host":"10.0.2.130",
                "Score":10
            },
            {
                "Host":"10.0.2.142",
                "Score":10
            },
            {
                "Host":"10.0.2.164",
                "Score":10
            },
            {
                "Host":"10.0.2.57",
                "Score":10
            }
        ]
    },
    {
        "Strategy":"SelectorSpreadPriority",
        "Weight":1,
        "HostPriority":[
            {
                "Host":"10.0.2.130",
                "Score":10
            },
            {
                "Host":"10.0.2.142",
                "Score":10
            },
            {
                "Host":"10.0.2.164",
                "Score":10
            },
            {
                "Host":"10.0.2.57",
                "Score":10
            }
        ]
    },
    {
        "Strategy":"TaintTolerationPriority",
        "Weight":1,
        "HostPriority":[
            {
                "Host":"10.0.2.130",
                "Score":10
            },
            {
                "Host":"10.0.2.142",
                "Score":10
            },
            {
                "Host":"10.0.2.164",
                "Score":10
            },
            {
                "Host":"10.0.2.57",
                "Score":10
            }
        ]
    }
]
```

提示：可利用调度器的快照

##### 3. 给个未调度的pod的yaml，展示开发题1和开发题2的效果，但是不能把pod真实调度了，或影响调度器的实际缓存信息；

##### 4. 适当修改调度器源码，将开发题1和开发题2的效果，作为pod调度时的一个event存入ETCD等，并设置开关和有效存储时长；

##### 5. 将开发题1、2和3作为PR，提交给社区；

